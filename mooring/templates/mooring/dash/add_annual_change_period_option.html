{% extends 'mooring/base.html' %}
{% load static %}
{% load users %}

{% block extra_css %}
    {% include 'mooring/block_extra_css.html' %}
    <link href="/static/common/css/bootstrap-datetimepicker.css?ver={{ GIT_COMMIT_HASH }}" rel="stylesheet"/>
{% endblock %}

{% block extra_js %}
{% endblock %}

{% block requirements %}
{% endblock %}

{% block content %}
<script src="/static/common/js/bootstrap-datetimepicker.min.js?ver={{ GIT_COMMIT_HASH }}"></script>
<style>
.input-border-error {
	border: 2px solid red; 
	border-radius: 4px; 
	position: absolute;
}		
</style>

<div class="container" id="dashboard-table-container" iistyle='position: relative'>
<a href='{% url 'dash-annual-bookingperiod-group-view' bp_group_id %}' type="button" class="btn btn-primary" style="">Go Back</a><BR><BR>
<div class="card">
    <div class="card-header" role="tab" id="title_booking_period">
        <h2 class="mb-0">
            <a
                class="btn d-flex justify-content-between align-items-center w-100 text-start text-decoration-none"
                role="button"
                data-bs-toggle="collapse"
                data-bs-target="#collapse_period_groups"
                aria-expanded="true"
                aria-controls="collapse_period_groups"
            >
                <h3 class="mb-0">Booking Period</h3>
            </a>
        </h2>
    </div>

    <div id="collapse_booking_period" role="tabpanel" aria-labelledby="title_booking_period">
        <div class="card-body">
            <div class="col-lg-12">
                {% load crispy_forms_tags %}
                {% block page_content_inner %}
                    <h1>{{ page_heading }}</h1>
                    {% crispy form %}
                {% endblock %}
            </div>
        </div>
    </div>
</div>
</div>

<script src="/static/common/js/oracle_refund.js?ver={{ GIT_COMMIT_HASH }}"></script>
<script>
    function sleep(time) {
        return new Promise((resolve) => setTimeout(resolve, time));
    }

    function check_oracle_codes() {
        $('#submit-id-update').attr('disabled', true);
        $('#loader-spinner').html('<img src="/static/common/img/ajax-loader-spinner.gif">&nbsp;&nbsp;<strong>Please Wait Loading</strong>');
        sleep(300).then(() => {
            var allow_submit = true;
            $('#id_annual_booking_periods_form input').each(
                function(index) {
                    var input = $(this);
                    var id_input = input.attr('id');
                    if (id_input) {
                        var input_oracle_id = id_input.slice(0,26);
                        var id_input_value = $('#'+id_input).val();
                        if (input_oracle_id == 'id_vs_category_oracle_code') {
                            if (refund_booking.check_oracle_code(id_input_value) == false) {
                                $('#'+id_input).addClass('input-border-error');
                                allow_submit = false;
                            } else {
                                $('#'+id_input).removeClass('input-border-error');
                            }
                        }
                    }
                }
            );

            if (allow_submit == true) {
                $('#id_annual_booking_periods_form').submit();
            } else {
                $('#loader-spinner').html('');
                $('#submit-id-update').attr('disabled', false);
            }
        });
      }
      window.onload= function() {
        var startpicker = $('#id_start_time').datetimepicker({
            format: 'DD/MM/YYYY HH:mm',
        });
        
        var startpicker = $('#id_finish_time').datetimepicker({
            format: 'DD/MM/YYYY HH:mm',
        });
    }
</script>
{% endblock %}
