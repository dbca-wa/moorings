{% extends 'mooring/base.html' %}
{% load static %}
{% block extra_css %}
    {{ block.super }}
    <style>
        .bold {
            font-weight: bold;
        }
        .table>tbody>tr>td, .table>tbody>tr>th, .table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th{
            border:none;
        }
    </style>
{% endblock %}
{% block content %}
    <div class="container">
        <h2>Booking History</h2>
        
        <div class="pull-right">
            <a class='btn btn-primary' href="{{ LEDGER_UI_URL }}/ledger/payments/oracle/payments?booking_reference=PS-{{ booking_id }}" target="_blank">Ledger Payments</a>
        </div>

        <table cellspacing="0" width="100%" id="bookings-table" class="hover table table-striped table-bordered dt-responsive nowrap dataTable no-footer dtr-inline" role="grid" aria-describedby="bookings-table_info">
            <thead>
                <tr>
                    <th>Confirmation#</th>
                    <th>Booking Type</th>
                    <th>Linked Admission</th>
                    <th>Total</th>
                    <th>Booking Date<br>Booked By</th>
                    <th>Cancel Date<br>Cancelled By<br>Cancellation Reason</th>
                    <th width='125px'>Invoices#</th>
                </tr>
            </thead>
            <tbody> 
            {% for bh in booking_history %}
                {% if bh.booking.booking_type != 3 %}
                    <tr>
                        <td><A title='New Booking' HREF='/api/get_confirmation/{{ bh.booking.id }}'>PS{{ bh.booking.id }}</A> {% if bh.booking.old_booking %}<i style="color:red;" class="fa fa-arrow-right"></i> <A title='OLD Booking' HREF='/api/get_confirmation/{{ bh.booking.old_booking.id }}'>PS{{ bh.booking.old_booking.id }}{% endif %}</A></td>
                        <th>{{ bh.booking.get_booking_type_display }}</th>
                        <td>{% if bh.booking.admission_payment %}<A HREF='/api/get_admissions_confirmation/{{ bh.booking.admission_payment.id }}'>AD{{ bh.booking.admission_payment.id }}{% endif %}</A></td>
                        <td style='color: {% if bh.booking.cost_total > 0 %}red{% elif  bh.booking.cost_total < 0 %}green{% endif %}'  >${{ bh.booking.cost_total }}</td>
                        <td>
                            {{ bh.booking.created }}
                            {{ bh.booking.created_by }}
                        </td>
                        <td>
                            {% if bh.booking.cancelation_time %}{{ bh.booking.cancelation_time }}{% endif %}<BR>
                                {% if bh.booking.canceled_by  %}{{ bh.booking.canceled_by }}{% endif %}<br>
                            {% if bh.booking.cancellation_reason  %}<div style='border: solid 1px #dedede; background-color: #FFFFFF; width: 100%; padding: 2px;'>{{ bh.booking.cancellation_reason }}</div>{% endif %}
                        </td>

                        <td>
                            {% for bi in bh.invoices %}
                                <A href='{{ LEDGER_UI_URL }}/ledger/payments/invoice-pdf/{{ bi.invoice_reference }}'><i style="color:red;" class="fa fa-file-pdf-o"></i>&nbsp;{{ bi.invoice_reference }}</A><BR>
                            {% endfor %}
                        </td>
                    </tr> 
                {% endif %}
		    {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
